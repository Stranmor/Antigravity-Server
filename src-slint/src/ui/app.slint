// Antigravity Manager - Main Application Window

import { VerticalBox, HorizontalBox, ScrollView, LineEdit, ComboBox, Switch } from "std-widgets.slint";
import { Dashboard } from "dashboard.slint";
import { AccountsPage, AccountData, FilterType, ViewMode } from "accounts.slint";
import { SettingsPage, SettingsData } from "settings.slint";
import { ApiProxyPage, ProxyStatus, ProxyConfig } from "proxy.slint";
import { Sidebar } from "components/sidebar.slint";
import { Theme } from "components/theme.slint";
import { AppState } from "globals.slint";

export struct DashboardStats {
    total_accounts: int,
    avg_gemini: int,
    avg_gemini_image: int,
    avg_claude: int,
    low_quota_count: int,
}

export struct CurrentAccountInfo {
    email: string,
    name: string,
    last_used: string,
    has_account: bool,
}

export component AppWindow inherits Window {
    title: "Antigravity Manager";
    min-width: 1100px;
    min-height: 700px;
    background: Theme.background;
    
    // Dashboard stats
    in-out property <DashboardStats> stats: {
        total_accounts: 0,
        avg_gemini: 0,
        avg_gemini_image: 0,
        avg_claude: 0,
        low_quota_count: 0,
    };
    
    in-out property <CurrentAccountInfo> current_account: {
        email: "",
        name: "",
        last_used: "",
        has_account: false,
    };
    
    // Page: 0=Dashboard, 1=Accounts, 2=Proxy, 3=Settings, 4=Monitor
    in-out property <int> current-page: 0;
    
    // Dashboard callbacks
    callback navigate(int);
    callback refresh-accounts();
    callback add-account();
    callback switch-account();
    
    navigate(page) => { current-page = page; }
    
    HorizontalBox {
        padding: 0px;
        spacing: 0px;
        
        Sidebar {
            width: 220px;
            current-page: root.current-page;
            navigate(page) => { root.navigate(page); }
        }
        
        Rectangle {
            background: Theme.background;
            
            // Dashboard
            if current-page == 0: Dashboard {
                width: 100%;
                height: 100%;
                stats: root.stats;
                current-account: root.current_account;
                refresh-accounts => { root.refresh-accounts(); }
                add-account => { root.add-account(); }
                switch-account => { root.switch-account(); }
            }
            
            // Accounts
            if current-page == 1: AccountsPage {
                width: 100%;
                height: 100%;
                accounts: AppState.accounts;
                selected-count: AppState.selected-count;
                is-refreshing: AppState.is-refreshing;
                current-page: AppState.current-page;
                total-pages: AppState.total-pages;
                total-items: AppState.total-items;
                all-count: AppState.all-count;
                pro-count: AppState.pro-count;
                ultra-count: AppState.ultra-count;
                free-count: AppState.free-count;
                
                add-account => { AppState.add-account(); }
                refresh-all => { AppState.refresh-all(); }
                export-selected => { AppState.export-selected(); }
                delete-selected => { AppState.delete-selected(); }
                toggle-proxy-batch(e) => { AppState.toggle-proxy-batch(e); }
                search-changed(q) => { AppState.search-changed(q); }
                toggle-select(id) => { AppState.toggle-select(id); }
                toggle-all => { AppState.toggle-all(); }
                switch-account(id) => { AppState.switch-account(id); }
                refresh-account(id) => { AppState.refresh-account(id); }
                view-details(id) => { AppState.view-details(id); }
                export-account(id) => { AppState.export-account(id); }
                delete-account(id) => { AppState.delete-account(id); }
                toggle-proxy(id) => { AppState.toggle-proxy(id); }
            }
            
            // Proxy
            if current-page == 2: ApiProxyPage {
                width: 100%;
                height: 100%;
                // TODO: Bind status and config from AppState
            }
            
            // Settings
            if current-page == 3: SettingsPage {
                width: 100%;
                height: 100%;
            }
            
            // Monitor
            if current-page == 4: Rectangle {
                background: Theme.background;
                
                VerticalLayout {
                    padding: 24px;
                    spacing: 16px;
                    
                    HorizontalLayout {
                        Text {
                            text: "Request Monitor";
                            color: Theme.text-primary;
                            font-size: 24px;
                            font-weight: 700;
                            horizontal-stretch: 1;
                        }
                        
                        Rectangle {
                            width: 100px;
                            height: 32px;
                            background: Theme.error;
                            border-radius: 8px;
                            
                            Text {
                                text: "Clear All";
                                color: white;
                                font-size: 13px;
                                font-weight: 500;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                            
                            TouchArea { mouse-cursor: pointer; }
                        }
                    }
                    
                    Text {
                        text: "Real-time API request logging";
                        color: Theme.text-secondary;
                        font-size: 14px;
                    }
                    
                    Rectangle {
                        vertical-stretch: 1;
                        background: Theme.surface;
                        border-radius: 12px;
                        border-width: 1px;
                        border-color: Theme.border;
                        
                        VerticalLayout {
                            Rectangle {
                                height: 40px;
                                background: Theme.surface-elevated;
                                border-radius: 12px;
                                
                                HorizontalLayout {
                                    padding-left: 16px;
                                    padding-right: 16px;
                                    spacing: 16px;
                                    
                                    Text {
                                        width: 80px;
                                        text: "Time";
                                        color: Theme.text-secondary;
                                        font-size: 12px;
                                        font-weight: 600;
                                        vertical-alignment: center;
                                    }
                                    
                                    Text {
                                        width: 60px;
                                        text: "Method";
                                        color: Theme.text-secondary;
                                        font-size: 12px;
                                        font-weight: 600;
                                        vertical-alignment: center;
                                    }
                                    
                                    Text {
                                        horizontal-stretch: 1;
                                        text: "Endpoint";
                                        color: Theme.text-secondary;
                                        font-size: 12px;
                                        font-weight: 600;
                                        vertical-alignment: center;
                                    }
                                    
                                    Text {
                                        width: 60px;
                                        text: "Status";
                                        color: Theme.text-secondary;
                                        font-size: 12px;
                                        font-weight: 600;
                                        vertical-alignment: center;
                                    }
                                    
                                    Text {
                                        width: 150px;
                                        text: "Account";
                                        color: Theme.text-secondary;
                                        font-size: 12px;
                                        font-weight: 600;
                                        vertical-alignment: center;
                                    }
                                }
                            }
                            
                            Rectangle {
                                vertical-stretch: 1;
                                
                                VerticalLayout {
                                    alignment: center;
                                    spacing: 12px;
                                    
                                    Text {
                                        text: "ðŸ“¡";
                                        font-size: 48px;
                                        horizontal-alignment: center;
                                    }
                                    
                                    Text {
                                        text: "No Requests Yet";
                                        color: Theme.text-primary;
                                        font-size: 18px;
                                        font-weight: 600;
                                        horizontal-alignment: center;
                                    }
                                    
                                    Text {
                                        text: "Requests will appear here in real-time";
                                        color: Theme.text-muted;
                                        font-size: 14px;
                                        horizontal-alignment: center;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

export { AccountData, FilterType, ViewMode, AppState }
